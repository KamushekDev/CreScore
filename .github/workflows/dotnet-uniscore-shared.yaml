name: dotnet - Uniscore.Shared
on:
  push:
    paths:
      - ".github/**"
      - "dotnet/uniscore-shared/**"
env:
  folder: "./dotnet/uniscore-shared"
jobs:
  init:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
    steps:
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.1
        with:
          access_token: ${{ github.token }}
      - name: Checkout
        uses: actions/checkout@v3
      - name: Generate version
        id: version
        uses: ./.github/actions/generate-version

  build:
    runs-on: ubuntu-latest
    needs: init
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Cache nuget
        uses: actions/cache@v1
        with:
          path: ~/.nuget/packages
          key: nuget-${{ runner.os }}-${{ env.folder }}-${{ hashFiles('**/*.csproj') }} #hash of project files
          restore-keys: |
            nuget-${{ runner.os }}-${{ env.folder }}-
            nuget-${{ runner.os }}-
      - name: Build
        uses: ./.github/actions/build-dotnet
        with: 
          folder: ${{ env.folder }}
          version: ${{ needs.init.outputs.version }}

  publish-nugets:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Add source
        uses: ./.github/actions/add-github-source
      - name: Publish nugets
        uses: ./.github/actions/publish-nugets

